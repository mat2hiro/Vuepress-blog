<!DOCTYPE html>
<html lang="ja-JP">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GitHub actionsでpandocを使ってpdfをコンパイル、そのままpushする | mat2&#39;s tech blog</title>
    <meta name="description" content="markdownでレポートを書き、gitで差分管理しつつpdfへの自動コンパイル">
    <script src="https://kit.fontawesome.com/4303b21f4b.js" crossorigin="anonymous"></script>
  <link rel="icon" type="image/png" href="/icon/favicon.png">
  <meta name="google-site-verification" content="IlPoCiloaoSPffpYU1OaEpLY1YEnCgkjdM6KfuNCN6g">
  <link rel="alternate" type="application/rss+xml" href="https://mat2.net/rss.xml" title="mat2&#39;s tech blog RSS Feed">
  <link rel="alternate" type="application/atom+xml" href="https://mat2.net/feed.atom" title="mat2&#39;s tech blog Atom Feed">
  <link rel="alternate" type="application/json" href="https://mat2.net/feed.json" title="mat2&#39;s tech blog JSON Feed">
    <meta property="article:published_time" content="2020-01-09T00:00:00.000Z"><meta property="article:modified_time" content="2020-01-10T06:26:13.000Z"><meta property="og:site_name" content="mat2&#39;s tech blog"><meta property="og:title" content="GitHub actionsでpandocを使ってpdfをコンパイル、そのままpushする"><meta property="og:description" content="markdownでレポートを書き、gitで差分管理しつつpdfへの自動コンパイル"><meta property="og:type" content="website"><meta property="og:url" content="https://mat2.net/posts/2020/01/09/github-actions-with-pandoc.html"><meta property="og:image" content="https://mat2.net/img/posts/mtpa.jpg"><meta name="twitter:title" content="GitHub actionsでpandocを使ってpdfをコンパイル、そのままpushする"><meta name="twitter:description" content="markdownでレポートを書き、gitで差分管理しつつpdfへの自動コンパイル"><meta name="twitter:url" content="https://mat2.net/posts/2020/01/09/github-actions-with-pandoc.html"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://mat2.net/img/posts/mtpa.jpg"><meta name="twitter:label2" content="Filed under"><meta name="twitter:data2" content="github actions, pandoc, docker"><meta property="article:tag" content="github actions"><meta property="article:tag" content="pandoc"><meta property="article:tag" content="docker">
    <link rel="preload" href="/assets/css/0.styles.127d47b3.css" as="style"><link rel="preload" href="/assets/js/app.82a99b5c.js" as="script"><link rel="preload" href="/assets/js/3.41213ef4.js" as="script"><link rel="preload" href="/assets/js/13.69562b3b.js" as="script"><link rel="prefetch" href="/assets/js/1.861271ce.js"><link rel="prefetch" href="/assets/js/10.7081f6c3.js"><link rel="prefetch" href="/assets/js/11.35aedcf8.js"><link rel="prefetch" href="/assets/js/12.d72bf2b0.js"><link rel="prefetch" href="/assets/js/14.f8ebfd53.js"><link rel="prefetch" href="/assets/js/15.cb9c1a71.js"><link rel="prefetch" href="/assets/js/16.fe92c644.js"><link rel="prefetch" href="/assets/js/17.254ba726.js"><link rel="prefetch" href="/assets/js/18.0e02fed6.js"><link rel="prefetch" href="/assets/js/4.d5e1f395.js"><link rel="prefetch" href="/assets/js/5.d87ec286.js"><link rel="prefetch" href="/assets/js/6.95cf8a6e.js"><link rel="prefetch" href="/assets/js/7.d2e62331.js"><link rel="prefetch" href="/assets/js/8.4067f694.js"><link rel="prefetch" href="/assets/js/9.059cbd73.js">
    <link rel="stylesheet" href="/assets/css/0.styles.127d47b3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" data-v-03d49b07><div data-v-23e3c9ad data-v-03d49b07><nav class="navbar" data-v-23e3c9ad><div class="container" data-v-23e3c9ad><a href="/" class="router-link-active" data-v-23e3c9ad><span class="navbar-site-name" data-v-23e3c9ad>
          mat2's tech blog
        </span></a> <div class="navbar-toggler" data-v-23e3c9ad><svg class="icon" style="font-size:1.2em;" data-v-23e3c9ad data-v-23e3c9ad><title data-v-23e3c9ad data-v-23e3c9ad>menu</title><use xlink:href="#icon-menu" data-v-23e3c9ad data-v-23e3c9ad></use></svg></div> <div class="navbar-closer-bg" data-v-23e3c9ad></div> <div class="navbar-links" data-v-23e3c9ad><div class="navbar-closer" data-v-23e3c9ad><svg class="icon" style="font-size:1.2em;" data-v-23e3c9ad data-v-23e3c9ad><title data-v-23e3c9ad data-v-23e3c9ad>menu</title><use xlink:href="#icon-menu" data-v-23e3c9ad data-v-23e3c9ad></use></svg></div> <a href="/" class="navbar-link" data-v-23e3c9ad>
            Home
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-23e3c9ad>
            Posts
          </a><a href="/profile/" class="navbar-link" data-v-23e3c9ad>
            Profile
          </a><a href="/links/" class="navbar-link" data-v-23e3c9ad>
            Links
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-23e3c9ad></div></div> <!----></header> <div class="container clearfix show-aside" data-v-21461159 data-v-21461159><main class="main" data-v-21461159><div class="post" data-v-21461159 data-v-21461159><div class="post-header-banner"><h1>
      GitHub actionsでpandocを使ってpdfをコンパイル、そのままpushする
    </h1></div> <section class="post-meta main-div" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:linear-gradient(0,rgba(255,255,255,.5),rgba(255,255,255,.8)),\n          url(/img/posts/mtpa.jpg);" data-v-4bafd1e2><section class="post-breadcrumbs" data-v-4bafd1e2><span class="post-info-item" data-v-4bafd1e2><a href="/posts/categories/tech.html" data-v-4bafd1e2><span title="tech" data-v-4bafd1e2><svg class="icon" style="font-size:1em;" data-v-4bafd1e2><title data-v-4bafd1e2>tech</title><use xlink:href="#icon-category" data-v-4bafd1e2></use></svg><span class="info-text" data-v-4bafd1e2>
          tech
        </span></span></a></span> <span class="post-info-item" data-v-4bafd1e2><span data-v-4bafd1e2 data-v-4bafd1e2><svg class="icon" style="font-size:1em;" data-v-4bafd1e2 data-v-4bafd1e2><title data-v-4bafd1e2 data-v-4bafd1e2>tags</title><use xlink:href="#icon-tags" data-v-4bafd1e2 data-v-4bafd1e2></use></svg><span class="info-text" data-v-4bafd1e2 data-v-4bafd1e2><a href="/posts/tags/github actions.html" title="github actions" data-v-4bafd1e2>
          github actions, 
        </a><a href="/posts/tags/pandoc.html" title="pandoc" data-v-4bafd1e2>
          pandoc, 
        </a><a href="/posts/tags/docker.html" title="docker" data-v-4bafd1e2>
          docker
        </a></span></span></span></section> <section class="post-date clearfix" data-v-4bafd1e2><span class="create-date" data-v-4bafd1e2>
      作成日 : 2020-01-09
    </span> <span class="update-date" data-v-4bafd1e2>
      更新日 : 2020-01-10
    </span></section> <div class="share-buttons" style="justify-content:flex-end;" data-v-36409159 data-v-4bafd1e2><a href="http://www.facebook.com/share.php?u=" rel="nofollow" target="_blank" class="share-fb" data-v-36409159><div data-v-36409159><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-facebook fa-w-16" data-v-36409159 data-v-36409159><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z" data-v-36409159 data-v-36409159></path></svg> シェア</div></a> <a href="https://twitter.com/share?url=&amp;text=" rel="nofollow" target="_blank" class="share-twitter" data-v-36409159><div data-v-36409159><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-twitter fa-w-16" data-v-36409159 data-v-36409159><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" data-v-36409159 data-v-36409159></path></svg> ツイート</div></a> <a href="http://b.hatena.ne.jp/add?mode=confirm&amp;url=&amp;title=" target="_blank" rel="nofollow" class="share-hateb" data-v-36409159><div data-v-36409159><svg class="icon" data-v-36409159 data-v-36409159><title data-v-36409159 data-v-36409159>hateb</title><use xlink:href="#icon-hateb" data-v-36409159 data-v-36409159></use></svg> ブックマーク</div></a> <a href="http://getpocket.com/edit?url=&amp;title=" rel="nofollow" target="_blank" class="share-pocket" data-v-36409159><div data-v-36409159><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="get-pocket" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-get-pocket fa-w-14" data-v-36409159 data-v-36409159><path fill="currentColor" d="M407.6 64h-367C18.5 64 0 82.5 0 104.6v135.2C0 364.5 99.7 464 224.2 464c124 0 223.8-99.5 223.8-224.2V104.6c0-22.4-17.7-40.6-40.4-40.6zm-162 268.5c-12.4 11.8-31.4 11.1-42.4 0C89.5 223.6 88.3 227.4 88.3 209.3c0-16.9 13.8-30.7 30.7-30.7 17 0 16.1 3.8 105.2 89.3 90.6-86.9 88.6-89.3 105.5-89.3 16.9 0 30.7 13.8 30.7 30.7 0 17.8-2.9 15.7-114.8 123.2z" data-v-36409159 data-v-36409159></path></svg> Pocket</div></a> <a href="http://line.me/R/msg/text/" target="_blank" rel="nofollow" class="share-line" data-v-36409159><div data-v-36409159><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="line" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-line fa-w-14" data-v-36409159 data-v-36409159><path fill="currentColor" d="M272.1 204.2v71.1c0 1.8-1.4 3.2-3.2 3.2h-11.4c-1.1 0-2.1-.6-2.6-1.3l-32.6-44v42.2c0 1.8-1.4 3.2-3.2 3.2h-11.4c-1.8 0-3.2-1.4-3.2-3.2v-71.1c0-1.8 1.4-3.2 3.2-3.2H219c1 0 2.1.5 2.6 1.4l32.6 44v-42.2c0-1.8 1.4-3.2 3.2-3.2h11.4c1.8-.1 3.3 1.4 3.3 3.1zm-82-3.2h-11.4c-1.8 0-3.2 1.4-3.2 3.2v71.1c0 1.8 1.4 3.2 3.2 3.2h11.4c1.8 0 3.2-1.4 3.2-3.2v-71.1c0-1.7-1.4-3.2-3.2-3.2zm-27.5 59.6h-31.1v-56.4c0-1.8-1.4-3.2-3.2-3.2h-11.4c-1.8 0-3.2 1.4-3.2 3.2v71.1c0 .9.3 1.6.9 2.2.6.5 1.3.9 2.2.9h45.7c1.8 0 3.2-1.4 3.2-3.2v-11.4c0-1.7-1.4-3.2-3.1-3.2zM332.1 201h-45.7c-1.7 0-3.2 1.4-3.2 3.2v71.1c0 1.7 1.4 3.2 3.2 3.2h45.7c1.8 0 3.2-1.4 3.2-3.2v-11.4c0-1.8-1.4-3.2-3.2-3.2H301v-12h31.1c1.8 0 3.2-1.4 3.2-3.2V234c0-1.8-1.4-3.2-3.2-3.2H301v-12h31.1c1.8 0 3.2-1.4 3.2-3.2v-11.4c-.1-1.7-1.5-3.2-3.2-3.2zM448 113.7V399c-.1 44.8-36.8 81.1-81.7 81H81c-44.8-.1-81.1-36.9-81-81.7V113c.1-44.8 36.9-81.1 81.7-81H367c44.8.1 81.1 36.8 81 81.7zm-61.6 122.6c0-73-73.2-132.4-163.1-132.4-89.9 0-163.1 59.4-163.1 132.4 0 65.4 58 120.2 136.4 130.6 19.1 4.1 16.9 11.1 12.6 36.8-.7 4.1-3.3 16.1 14.1 8.8 17.4-7.3 93.9-55.3 128.2-94.7 23.6-26 34.9-52.3 34.9-81.5z" data-v-36409159 data-v-36409159></path></svg> Lineで送る</div></a> <!----></div></section> <article class="main-div"><div class="post-content content content__default"><h2 id="ポイント"><a href="#ポイント" class="header-anchor">#</a> ポイント</h2> <ul><li><p>pandocを用いてmarkdownを（tex経由の）pdfにコンパイルするdocker imageを作る</p> <ul><li>documentclassはltjsbookがいいな</li> <li>自前のテンプレートを使って様々な体裁に対応</li> <li>bibliographyファイルを用意すれば、参考文献も載せられる</li></ul></li> <li><p>上記imageを用いて、自動コンパイル+そのままgit pushするgithub actionsを作る</p></li></ul> <h2 id="動機"><a href="#動機" class="header-anchor">#</a> 動機</h2> <p>レポートや論文をmarkdownで書きたい。texで消耗もしないし、テキストファイルで書ければ差分管理も楽ちんなので。</p> <p>ただし、markdownで書いたままの落書きでは人様に見せられないので、体裁を整えて然るべき拡張子のファイルにする必要がある。</p> <p>pandocでmd-&gt;tex-&gt;pdfとコンパイルすることにした。<br>
で、<a href="https://github.com/Kumassy/docker-alpine-pandoc-ja" target="_blank" rel="noopener noreferrer">これをやってくれるdocker image<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>がある。（今回はbibliographyを載せたいので、このイメージをちょっといじるけどね）</p> <p>実際使ってみたが<br>
md書く-&gt;pdfにコンパイル-&gt;git push<br>
↑この工程のうち、毎回コンパイル挟むのが面倒になってきた。（すぐ面倒臭がる）</p> <p>なのでpandocによるコンパイルをgit push後に自動でやってもらう事にした。←今回の本題</p> <h2 id="pandocを乗っけたdocker-image"><a href="#pandocを乗っけたdocker-image" class="header-anchor">#</a> pandocを乗っけたdocker image</h2> <p>基本は以下の記事を読んでください。</p> <p><a href="https://qiita.com/Kumassy/items/ffa752da5f7193c4929c" target="_blank" rel="noopener noreferrer">まだまだ Word で消耗してるの？ 大学のレポートを Markdown で書こう （Docker 編）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>ただ、上記イメージにはbibliographyを挿入するのに必要なpandoc-citeprocが入っていなかったので、入れ直すついでにpandocのバージョンも上げた。</p> <details><summary>pandoc入れ直すDockerfile</summary> <div class="language-Docker extra-class"><pre class="language-docker"><code><span class="token keyword">FROM</span> kumassy/alpine<span class="token punctuation">-</span>pandoc<span class="token punctuation">-</span>ja

<span class="token keyword">WORKDIR</span> /src

<span class="token keyword">COPY</span> ./ /src

<span class="token keyword">RUN</span> ls <span class="token punctuation">-</span>la

<span class="token keyword">RUN</span> apk update &amp;&amp; \
  apk upgrade &amp;&amp; \
  apk add <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>cache git

<span class="token keyword">RUN</span> wget https<span class="token punctuation">:</span>//github.com/jgm/pandoc/releases/download/2.9.1.1/pandoc<span class="token punctuation">-</span>2.9.1.1<span class="token punctuation">-</span>linux<span class="token punctuation">-</span>amd64.tar.gz
<span class="token keyword">RUN</span> tar xvfz pandoc<span class="token punctuation">-</span>2.9.1.1<span class="token punctuation">-</span>linux<span class="token punctuation">-</span>amd64.tar.gz
<span class="token keyword">RUN</span> cp pandoc<span class="token punctuation">-</span>2.9.1.1/bin/* /usr/local/bin/

<span class="token keyword">RUN</span> rm <span class="token punctuation">-</span>r /usr/bin/pandoc<span class="token punctuation">-</span>crossref \
  &amp;&amp; wget https<span class="token punctuation">:</span>//github.com/lierdakil/pandoc<span class="token punctuation">-</span>crossref/releases/download/v0.3.6.1a/linux<span class="token punctuation">-</span>pandoc_2_9_1.tar.gz <span class="token punctuation">-</span>q <span class="token punctuation">-</span>O <span class="token punctuation">-</span> <span class="token punctuation">|</span> tar xz \
  &amp;&amp; mv pandoc<span class="token punctuation">-</span>crossref /usr/bin/
</code></pre></div></details> <p>これをbuildして、</p> <div class="language-shell-session extra-class"><pre class="language-shell-session"><code><span class="token output"># イメージ名my-pandoc-jaとしてビルド
</span><span class="token command"><span class="token sh important">$</span> <span class="token bash language-bash">docker build ./ -t my-pandoc-ja</span></span>
</code></pre></div><p>こんな感じで使うとコンパイルできる。</p> <div class="language-shell-session extra-class"><pre class="language-shell-session"><code><span class="token output"># input.mdにreferences.bibを付け足してoutput.pdfに書き出す
</span><span class="token command"><span class="token sh important">$</span> <span class="token bash language-bash">docker run -it --rm -v <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>:/src my-pandoc-ja pandoc -F pandoc-crossref input.md -o output.pdf --pdf-engine<span class="token operator">=</span>lualatex --template mytemplate.tex -N --top-level-division<span class="token operator">=</span>chapter  --bibliography<span class="token operator">=</span>references.bib</span></span>
</code></pre></div><p>テンプレートは自前のものを用意するか、以下のようにデフォルトのテンプレートを吐き出して使うかする。</p> <div class="language-shell-session extra-class"><pre class="language-shell-session"><code><span class="token command"><span class="token sh important">$</span> <span class="token bash language-bash">docker run -it --rm -v <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>:/src my-pandoc-ja pandoc -D latex <span class="token operator">&gt;</span> mytemplate.tex</span></span>
</code></pre></div><p>おそらく目次以前のページに関するレイアウトをいじることになると思う。（表紙とか概要とか）<br>
自分は標準テンプレートのmaketitle部分をいじって、表紙にいろんな情報を載せられるようにした。</p> <h2 id="github-actionsで自動コンパイル"><a href="#github-actionsで自動コンパイル" class="header-anchor">#</a> github actionsで自動コンパイル</h2> <p>基本は以下リンクを参照。</p> <p><a href="https://help.github.com/ja/actions/automating-your-workflow-with-github-actions/configuring-a-workflow" target="_blank" rel="noopener noreferrer">ワークフローを設定する - GitHub ヘルプ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>pushされたらworkflowを起動させたいので、<code>on: push</code> を指定。</p> <h3 id="自前imageつかってコンパイルする"><a href="#自前imageつかってコンパイルする" class="header-anchor">#</a> 自前imageつかってコンパイルする</h3> <p>各stepの<code>uses</code>メンバにDockerfileが置いてあるディレクトリを指定することで、そのDockerfileをもとにしたイメージをビルドする。</p> <p><code>with.args</code>はビルドしたイメージでrunしたいコマンドを指定する。</p> <p>今回の場合は上記イメージにpandocによるコンパイルを任せたいので、</p> <div class="language-yml extra-class"><pre class="language-yml"><code>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> pdf compile
      <span class="token key atrule">uses</span><span class="token punctuation">:</span> ./path/to/image/
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token key atrule">args</span><span class="token punctuation">:</span> pandoc <span class="token punctuation">-</span>F pandoc<span class="token punctuation">-</span>crossref input.md <span class="token punctuation">-</span>o output.pdf <span class="token punctuation">-</span><span class="token punctuation">-</span>pdf<span class="token punctuation">-</span>engine=lualatex <span class="token punctuation">-</span><span class="token punctuation">-</span>template mytemplate.tex <span class="token punctuation">-</span>N <span class="token punctuation">-</span><span class="token punctuation">-</span>top<span class="token punctuation">-</span>level<span class="token punctuation">-</span>division=chapter  <span class="token punctuation">-</span><span class="token punctuation">-</span>bibliography=references.bib
</code></pre></div><p>こんな感じになる。</p> <h3 id="コンパイル結果をgit-pushする"><a href="#コンパイル結果をgit-pushする" class="header-anchor">#</a> コンパイル結果をgit pushする</h3> <p>このままではただコンパイルしただけになってしまうので、結果をどこかに上げるなりしないといけない。</p> <p>今回はそのままgit pushすることにした。<br>
（gitに無闇にバイナリを乗せるのもどうかと思うので、多分クラウドストレージにアップロードするなりした方がいい。）</p> <details><summary>gitにログインして変更をpushするコマンド</summary> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># gitユーザー設定</span>
<span class="token function">git</span> config --global user.name <span class="token string">&quot;your-git-username&quot;</span>
<span class="token function">git</span> config --global user.email <span class="token string">&quot;your-git-email&quot;</span>

<span class="token comment"># 追跡</span>
<span class="token function">git</span> remote set-url origin https://your-git-username:<span class="token variable">${GITHUB_TOKEN}</span>@github.com/your-repository.git

<span class="token function">git</span> checkout -b master

<span class="token comment">#</span>
<span class="token comment">#  なんやかんややる</span>
<span class="token comment">#</span>

<span class="token comment"># git push</span>
<span class="token function">git</span> status
<span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> commit -m <span class="token string">'[updater] update.'</span>
<span class="token function">git</span> push origin HEAD
</code></pre></div></details> <h3 id="２つをまとめる"><a href="#２つをまとめる" class="header-anchor">#</a> ２つをまとめる</h3> <p>まとめて以下のようなshを作った。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># gitユーザー設定</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;set git config.&quot;</span>
<span class="token function">git</span> config --global user.name <span class="token string">&quot;your-git-username&quot;</span>
<span class="token function">git</span> config --global user.email <span class="token string">&quot;your-git-email&quot;</span>

<span class="token comment"># 追跡</span>
<span class="token function">git</span> remote set-url origin https://your-git-username:<span class="token variable">${GITHUB_TOKEN}</span>@github.com/your-repository.git

<span class="token function">git</span> checkout -b master

<span class="token comment"># pandocでpdfコンパイル</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;build pdf.&quot;</span>
pandoc -F pandoc-crossref input.md -o output.pdf --pdf-engine<span class="token operator">=</span>lualatex --template mytemplate.tex -N --top-level-division<span class="token operator">=</span>chapter -B abstract.tex --bibliography<span class="token operator">=</span>references.bib

<span class="token comment"># git push</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;git push.&quot;</span>
<span class="token function">git</span> status
<span class="token function">git</span> <span class="token function">add</span> output.tex
<span class="token function">git</span> commit -m <span class="token string">'[updater] update pdf.'</span>
<span class="token function">git</span> push origin HEAD
</code></pre></div><p>やっていることは、</p> <ol><li>gitにログイン</li> <li>git追跡開始</li> <li>pdfコンパイル</li> <li>コンパイル結果のcommit, push</li></ol> <p>該当stepの<code>with.args</code>に、このshを実行するようにコマンドを渡せばok.</p> <div class="language-yml extra-class"><pre class="language-yml"><code>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> git update step
      <span class="token key atrule">uses</span><span class="token punctuation">:</span> ./.github/images/
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token key atrule">args</span><span class="token punctuation">:</span> sh ./lib/update.sh
</code></pre></div><h3 id="環境変数"><a href="#環境変数" class="header-anchor">#</a> 環境変数</h3> <p>出力結果などのファイル名を変えるのが面倒なので、<code>env</code>メンバに然るべき環境変数を置くことで出力ファイル名などの管理を簡単にする。</p> <h2 id="できた"><a href="#できた" class="header-anchor">#</a> できた</h2> <p><a href="https://github.com/mat2hiro/write-report-with-markdown" target="_blank" rel="noopener noreferrer">このリポジトリ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>に完成版があります。</p> <p>各人のリポジトリで試してみてください。<br>
pushしたら勝手に後追いでコンパイルしたpdfがpushされるはずです。</p> <h2 id="future-works"><a href="#future-works" class="header-anchor">#</a> future works</h2> <p>コンパイル結果をgitにpushするのではなく、適当なクラウドストレージにアップロードしたい。google driveでいいかな</p> <p>また、workflow自体はイメージを毎回ビルドするので遅い。早くするには</p> <ul><li>イメージを軽くしてパッケージレポジトリに上げる（多分texのみ入っているalpineイメージでも事足りるはず）</li> <li>キャッシュを使う（イメージのキャッシュってどうすればいいんだろう）</li></ul> <p>といいと思います（投げやり）</p> <p>遅いなら遅いで、コンパイルできたら通知するようにしてもいいかも
（slack連携なら秒でできるはず）</p></div></article> <section class="post-meta main-div" data-v-52613d0c><div data-v-52613d0c><div class="metas-title" data-v-52613d0c>Share &amp; Follow</div> <div class="share-buttons" style="justify-content:center;" data-v-36409159 data-v-52613d0c><a href="http://www.facebook.com/share.php?u=" rel="nofollow" target="_blank" class="share-fb" data-v-36409159><div data-v-36409159><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-facebook fa-w-16" data-v-36409159 data-v-36409159><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z" data-v-36409159 data-v-36409159></path></svg> シェア</div></a> <a href="https://twitter.com/share?url=&amp;text=" rel="nofollow" target="_blank" class="share-twitter" data-v-36409159><div data-v-36409159><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-twitter fa-w-16" data-v-36409159 data-v-36409159><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" data-v-36409159 data-v-36409159></path></svg> ツイート</div></a> <a href="http://b.hatena.ne.jp/add?mode=confirm&amp;url=&amp;title=" target="_blank" rel="nofollow" class="share-hateb" data-v-36409159><div data-v-36409159><svg class="icon" data-v-36409159 data-v-36409159><title data-v-36409159 data-v-36409159>hateb</title><use xlink:href="#icon-hateb" data-v-36409159 data-v-36409159></use></svg> ブックマーク</div></a> <a href="http://getpocket.com/edit?url=&amp;title=" rel="nofollow" target="_blank" class="share-pocket" data-v-36409159><div data-v-36409159><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="get-pocket" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-get-pocket fa-w-14" data-v-36409159 data-v-36409159><path fill="currentColor" d="M407.6 64h-367C18.5 64 0 82.5 0 104.6v135.2C0 364.5 99.7 464 224.2 464c124 0 223.8-99.5 223.8-224.2V104.6c0-22.4-17.7-40.6-40.4-40.6zm-162 268.5c-12.4 11.8-31.4 11.1-42.4 0C89.5 223.6 88.3 227.4 88.3 209.3c0-16.9 13.8-30.7 30.7-30.7 17 0 16.1 3.8 105.2 89.3 90.6-86.9 88.6-89.3 105.5-89.3 16.9 0 30.7 13.8 30.7 30.7 0 17.8-2.9 15.7-114.8 123.2z" data-v-36409159 data-v-36409159></path></svg> Pocket</div></a> <a href="http://line.me/R/msg/text/" target="_blank" rel="nofollow" class="share-line" data-v-36409159><div data-v-36409159><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="line" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-line fa-w-14" data-v-36409159 data-v-36409159><path fill="currentColor" d="M272.1 204.2v71.1c0 1.8-1.4 3.2-3.2 3.2h-11.4c-1.1 0-2.1-.6-2.6-1.3l-32.6-44v42.2c0 1.8-1.4 3.2-3.2 3.2h-11.4c-1.8 0-3.2-1.4-3.2-3.2v-71.1c0-1.8 1.4-3.2 3.2-3.2H219c1 0 2.1.5 2.6 1.4l32.6 44v-42.2c0-1.8 1.4-3.2 3.2-3.2h11.4c1.8-.1 3.3 1.4 3.3 3.1zm-82-3.2h-11.4c-1.8 0-3.2 1.4-3.2 3.2v71.1c0 1.8 1.4 3.2 3.2 3.2h11.4c1.8 0 3.2-1.4 3.2-3.2v-71.1c0-1.7-1.4-3.2-3.2-3.2zm-27.5 59.6h-31.1v-56.4c0-1.8-1.4-3.2-3.2-3.2h-11.4c-1.8 0-3.2 1.4-3.2 3.2v71.1c0 .9.3 1.6.9 2.2.6.5 1.3.9 2.2.9h45.7c1.8 0 3.2-1.4 3.2-3.2v-11.4c0-1.7-1.4-3.2-3.1-3.2zM332.1 201h-45.7c-1.7 0-3.2 1.4-3.2 3.2v71.1c0 1.7 1.4 3.2 3.2 3.2h45.7c1.8 0 3.2-1.4 3.2-3.2v-11.4c0-1.8-1.4-3.2-3.2-3.2H301v-12h31.1c1.8 0 3.2-1.4 3.2-3.2V234c0-1.8-1.4-3.2-3.2-3.2H301v-12h31.1c1.8 0 3.2-1.4 3.2-3.2v-11.4c-.1-1.7-1.5-3.2-3.2-3.2zM448 113.7V399c-.1 44.8-36.8 81.1-81.7 81H81c-44.8-.1-81.1-36.9-81-81.7V113c.1-44.8 36.9-81.1 81.7-81H367c44.8.1 81.1 36.8 81 81.7zm-61.6 122.6c0-73-73.2-132.4-163.1-132.4-89.9 0-163.1 59.4-163.1 132.4 0 65.4 58 120.2 136.4 130.6 19.1 4.1 16.9 11.1 12.6 36.8-.7 4.1-3.3 16.1 14.1 8.8 17.4-7.3 93.9-55.3 128.2-94.7 23.6-26 34.9-52.3 34.9-81.5z" data-v-36409159 data-v-36409159></path></svg> Lineで送る</div></a> <a href="https://mat2.net/feed.atom" target="_blank" class="follow-rss" data-v-36409159><div data-v-36409159><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-rss fa-w-14" data-v-36409159 data-v-36409159><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z" data-v-36409159 data-v-36409159></path></svg> RSS</div></a></div></div> <div class="mt1" data-v-52613d0c><div class="metas-title" data-v-52613d0c>Prev &amp; Next</div> <section class="post-links" data-v-52613d0c><a href="/posts/2019/07/30/helloworld.html" class="post-link prev-post" data-v-52613d0c><div data-v-52613d0c><span data-v-52613d0c>前の投稿 :</span> <span data-v-52613d0c>Hello, VuePress!!</span></div></a> <!----></section></div></section> <div id="disqus_thread"></div></div></main> <aside class="aside" data-v-21461159><div class="info-card main-div" data-v-50317dd7 data-v-21461159><div class="info-card-header" data-v-50317dd7><img src="https://pbs.twimg.com/profile_images/1092782177471741952/OnHQf9H2_400x400.jpg" alt="mat2" class="info-avatar" data-v-50317dd7></div> <div class="info-card-body" data-v-50317dd7><a href="/profile/" data-v-50317dd7><section class="info-nickname" data-v-50317dd7>
        mat2
      </section></a> <section class="info-desc" data-v-50317dd7>エンジニアをしたい</section> <section class="info-contact" data-v-50317dd7><!----> <section data-v-50317dd7><span title="Tokyo Institute of Technology/Techflyer,inc." data-v-50317dd7 data-v-50317dd7><svg class="icon" style="font-size:1em;" data-v-50317dd7 data-v-50317dd7><title data-v-50317dd7 data-v-50317dd7>Tokyo Institute of Technology/Techflyer,inc.</title><use xlink:href="#icon-organization" data-v-50317dd7 data-v-50317dd7></use></svg><span class="info-text" data-v-50317dd7 data-v-50317dd7>
          Tokyo Institute of Technology/Techflyer,inc.
        </span></span></section> <section data-v-50317dd7><span title="ondriver246.1u[at]gmail.com" data-v-50317dd7 data-v-50317dd7><svg class="icon" style="font-size:1em;" data-v-50317dd7 data-v-50317dd7><title data-v-50317dd7 data-v-50317dd7>ondriver246.1u[at]gmail.com</title><use xlink:href="#icon-email" data-v-50317dd7 data-v-50317dd7></use></svg><span class="info-text" data-v-50317dd7 data-v-50317dd7>
          ondriver246.1u[at]gmail.com
        </span></span></section></section></div> <div class="info-card-footer" data-v-50317dd7><section class="info-sns clearfix" data-v-50317dd7><a href="https://github.com/mat2hiro" target="_blank" class="sns-link" data-v-50317dd7><span title="GitHub: mat2hiro" class="sns-icon" data-v-50317dd7 data-v-50317dd7><svg class="icon" style="font-size:1.5em;" data-v-50317dd7 data-v-50317dd7><title data-v-50317dd7 data-v-50317dd7>GitHub: mat2hiro</title><use xlink:href="#icon-github" data-v-50317dd7 data-v-50317dd7></use></svg></span></a><a href="https://twitter.com/clC41UL" target="_blank" class="sns-link" data-v-50317dd7><span title="Twitter: お腹" class="sns-icon" data-v-50317dd7 data-v-50317dd7><svg class="icon" style="font-size:1.5em;" data-v-50317dd7 data-v-50317dd7><title data-v-50317dd7 data-v-50317dd7>Twitter: お腹</title><use xlink:href="#icon-twitter" data-v-50317dd7 data-v-50317dd7></use></svg></span></a></section></div></div> <!----> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-21461159><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>目次</span> <div class="post-nav-toc"><ul><li><a href="/posts/2020/01/09/github-actions-with-pandoc.html#ポイント">ポイント</a></li><li><a href="/posts/2020/01/09/github-actions-with-pandoc.html#動機">動機</a></li><li><a href="/posts/2020/01/09/github-actions-with-pandoc.html#pandocを乗っけたdocker-image">pandocを乗っけたdocker image</a></li><li><a href="/posts/2020/01/09/github-actions-with-pandoc.html#github-actionsで自動コンパイル">github actionsで自動コンパイル</a><ul><li><a href="/posts/2020/01/09/github-actions-with-pandoc.html#自前imageつかってコンパイルする">自前imageつかってコンパイルする</a></li><li><a href="/posts/2020/01/09/github-actions-with-pandoc.html#コンパイル結果をgit-pushする">コンパイル結果をgit pushする</a></li><li><a href="/posts/2020/01/09/github-actions-with-pandoc.html#２つをまとめる">２つをまとめる</a></li><li><a href="/posts/2020/01/09/github-actions-with-pandoc.html#環境変数">環境変数</a></li></ul></li><li><a href="/posts/2020/01/09/github-actions-with-pandoc.html#できた">できた</a></li><li><a href="/posts/2020/01/09/github-actions-with-pandoc.html#future-works">future works</a></li></ul></div></div> <!----></div></aside></div> <footer class="footer" data-v-78e29a84><p class="sns-links" data-v-78e29a84><a href="https://github.com/mat2hiro" target="_blank" class="sns-link" data-v-78e29a84><span title="GitHub: mat2hiro" class="sns-icon" data-v-78e29a84 data-v-78e29a84><svg class="icon" style="font-size:25px;" data-v-78e29a84 data-v-78e29a84><title data-v-78e29a84 data-v-78e29a84>GitHub: mat2hiro</title><use xlink:href="#icon-github" data-v-78e29a84 data-v-78e29a84></use></svg></span></a><a href="https://twitter.com/clC41UL" target="_blank" class="sns-link" data-v-78e29a84><span title="Twitter: お腹" class="sns-icon" data-v-78e29a84 data-v-78e29a84><svg class="icon" style="font-size:25px;" data-v-78e29a84 data-v-78e29a84><title data-v-78e29a84 data-v-78e29a84>Twitter: お腹</title><use xlink:href="#icon-twitter" data-v-78e29a84 data-v-78e29a84></use></svg></span></a></p> <p data-v-78e29a84><span data-v-78e29a84>Powered by </span> <a href="https://vuepress.vuejs.org" target="_blank" data-v-78e29a84>
      Vuepress
    </a></p></footer> <div id="fb-root"></div> <script async="async" defer="defer" crossorigin="anonymous" src="https://connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v4.0"></script></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.82a99b5c.js" defer></script><script src="/assets/js/3.41213ef4.js" defer></script><script src="/assets/js/13.69562b3b.js" defer></script>
  </body>
</html>
